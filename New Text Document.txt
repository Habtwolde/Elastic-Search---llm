# Delete index
curl -sS -X DELETE "http://localhost:9200/oracle_elser_index" -u "elastic:$env:ELASTIC_PASSWORD"

# Create index with correct mapping (CRITICAL: ml.tokens rank_features)
@'
{
  "mappings": {
    "properties": {
      "id":         { "type": "keyword" },
      "title":      { "type": "text" },
      "body":       { "type": "text" },
      "content":    { "type": "text" },
      "updated_at": { "type": "date" },
      "ml": {
        "properties": {
          "tokens": { "type": "rank_features" }
        }
      }
    }
  }
}
'@ | Set-Content -Encoding utf8 .\oracle_elser_index.json

curl -sS -X PUT "http://localhost:9200/oracle_elser_index" `
  -u "elastic:$env:ELASTIC_PASSWORD" `
  -H "Content-Type: application/json" `
  --data-binary "@oracle_elser_index.json"

































curl -u elastic:changeme -H "Content-Type: application/json" -X PUT http://localhost:9200/_ingest/pipeline/elser_oracle_pipeline -d @'
{
  "description": "ELSER enrichment for Oracle-ingested docs",
  "processors": [
    {
      "inference": {
        "model_id": ".elser_model_2",
        "input_output": [
          { "input_field": "body", "output_field": "ml.inference.body_expanded" }
        ],
        "on_failure": [
          { "set": { "field": "ml.inference_error", "value": "{{ _ingest.on_failure_message }}" } }
        ]
      }
    }
  ]
}
'@

